/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * SSD1306 OLED Display Driver for MAIA Project
 *
 * Copyright (c) 2026 Vinicius May
 *
 * Implementation of SSD1306 128x32 OLED driver with I2C interface.
 * Provides framebuffer-based rendering with dual font sizes.
 *
 * Hardware configuration:
 * - I2C bus shared with other devices (initialized by maia_board)
 * - Address: CONFIG_MAIA_SSD1306_I2C_ADDR (default 0x3C)
 * - Pull-ups: External 2.2k to 3.3V (shared I2C bus)
 *
 * References:
 * - SSD1306 Datasheet Rev 1.1 (Solomon Systech)
 * - ESP-IDF I2C Master Driver API v6.0+
 */

#include "ssd1306.h"
#include "maia_board.h"
#include "driver/i2c_master.h"
#include "esp_log.h"
#include <string.h>

/****************************************************************************
 * Pre-processor Definitions
 ****************************************************************************/

/* SSD1306 Command Definitions (Datasheet Section 9) */

#define SSD1306_CMD_SET_CONTRAST            0x81
#define SSD1306_CMD_DISPLAY_ALL_ON_RESUME   0xA4
#define SSD1306_CMD_DISPLAY_ALL_ON          0xA5
#define SSD1306_CMD_NORMAL_DISPLAY          0xA6
#define SSD1306_CMD_INVERT_DISPLAY          0xA7
#define SSD1306_CMD_DISPLAY_OFF             0xAE
#define SSD1306_CMD_DISPLAY_ON              0xAF
#define SSD1306_CMD_SET_DISPLAY_OFFSET      0xD3
#define SSD1306_CMD_SET_COMPINS             0xDA
#define SSD1306_CMD_SET_VCOMH_DESELECT      0xDB
#define SSD1306_CMD_SET_DISPLAY_CLK_DIV     0xD5
#define SSD1306_CMD_SET_PRECHARGE           0xD9
#define SSD1306_CMD_SET_MULTIPLEX           0xA8
#define SSD1306_CMD_SET_LOW_COLUMN          0x00
#define SSD1306_CMD_SET_HIGH_COLUMN         0x10
#define SSD1306_CMD_SET_START_LINE          0x40
#define SSD1306_CMD_MEMORY_MODE             0x20
#define SSD1306_CMD_COLUMN_ADDR             0x21
#define SSD1306_CMD_PAGE_ADDR               0x22
#define SSD1306_CMD_COM_SCAN_INC            0xC0
#define SSD1306_CMD_COM_SCAN_DEC            0xC8
#define SSD1306_CMD_SEG_REMAP               0xA0
#define SSD1306_CMD_CHARGE_PUMP             0x8D

/* Display dimensions from Kconfig */

#define SSD1306_WIDTH   CONFIG_MAIA_SSD1306_WIDTH
#define SSD1306_HEIGHT  CONFIG_MAIA_SSD1306_HEIGHT

/* Framebuffer size: (width * height) / 8 bits per byte */

#define SSD1306_BUFFER_SIZE  ((SSD1306_WIDTH * SSD1306_HEIGHT) / 8)

/* I2C communication parameters */

#define SSD1306_I2C_ADDR     CONFIG_MAIA_SSD1306_I2C_ADDR
#define SSD1306_TIMEOUT_MS   100

/* Control byte for I2C transmission */

#define SSD1306_CONTROL_CMD_SINGLE   0x80  /* Single command byte */
#define SSD1306_CONTROL_CMD_STREAM   0x00  /* Command stream */
#define SSD1306_CONTROL_DATA_STREAM  0x40  /* Data stream */

/* Font dimensions */

#define FONT_5X8_WIDTH   5
#define FONT_5X8_HEIGHT  8
#define FONT_8X16_WIDTH  8
#define FONT_8X16_HEIGHT 16

/* ASCII printable range */

#define FONT_FIRST_CHAR  0x20  /* Space */
#define FONT_LAST_CHAR   0x7E  /* Tilde ~ */

/****************************************************************************
 * Private Data
 ****************************************************************************/

static const char *TAG = "ssd1306";

/* Framebuffer: 512 bytes for 128x32 display (column-major order) */

static uint8_t g_framebuffer[SSD1306_BUFFER_SIZE];

/* I2C device handle (obtained from maia_board) */

static i2c_master_dev_handle_t g_ssd1306_handle = NULL;

/****************************************************************************
 * Font Data: 5x8 Bitmap Font
 *
 * Standard character generator ROM pattern (IBM PC BIOS, HD44780 LCD).
 * Functional data reproduction, industry standard bitmap.
 *
 * Each character is 5 bytes wide, 8 bits tall (7 used + 1 blank).
 * Each byte represents one vertical column, LSB at top.
 * Index = character - 0x20 (space).
 *
 * Supports ASCII 0x20-0x7E (95 printable characters).
 ****************************************************************************/

static const uint8_t g_font5x8[][5] =
{
  {0x00, 0x00, 0x00, 0x00, 0x00},  /* 0x20 Space */
  {0x00, 0x00, 0x5f, 0x00, 0x00},  /* 0x21 ! */
  {0x00, 0x07, 0x00, 0x07, 0x00},  /* 0x22 " */
  {0x14, 0x7f, 0x14, 0x7f, 0x14},  /* 0x23 # */
  {0x24, 0x2a, 0x7f, 0x2a, 0x12},  /* 0x24 $ */
  {0x23, 0x13, 0x08, 0x64, 0x62},  /* 0x25 % */
  {0x36, 0x49, 0x55, 0x22, 0x50},  /* 0x26 & */
  {0x00, 0x05, 0x03, 0x00, 0x00},  /* 0x27 ' */
  {0x00, 0x1c, 0x22, 0x41, 0x00},  /* 0x28 ( */
  {0x00, 0x41, 0x22, 0x1c, 0x00},  /* 0x29 ) */
  {0x14, 0x08, 0x3e, 0x08, 0x14},  /* 0x2A * */
  {0x08, 0x08, 0x3e, 0x08, 0x08},  /* 0x2B + */
  {0x00, 0x50, 0x30, 0x00, 0x00},  /* 0x2C , */
  {0x08, 0x08, 0x08, 0x08, 0x08},  /* 0x2D - */
  {0x00, 0x60, 0x60, 0x00, 0x00},  /* 0x2E . */
  {0x20, 0x10, 0x08, 0x04, 0x02},  /* 0x2F / */
  {0x3e, 0x51, 0x49, 0x45, 0x3e},  /* 0x30 0 */
  {0x00, 0x42, 0x7f, 0x40, 0x00},  /* 0x31 1 */
  {0x42, 0x61, 0x51, 0x49, 0x46},  /* 0x32 2 */
  {0x21, 0x41, 0x45, 0x4b, 0x31},  /* 0x33 3 */
  {0x18, 0x14, 0x12, 0x7f, 0x10},  /* 0x34 4 */
  {0x27, 0x45, 0x45, 0x45, 0x39},  /* 0x35 5 */
  {0x3c, 0x4a, 0x49, 0x49, 0x30},  /* 0x36 6 */
  {0x01, 0x71, 0x09, 0x05, 0x03},  /* 0x37 7 */
  {0x36, 0x49, 0x49, 0x49, 0x36},  /* 0x38 8 */
  {0x06, 0x49, 0x49, 0x29, 0x1e},  /* 0x39 9 */
  {0x00, 0x36, 0x36, 0x00, 0x00},  /* 0x3A : */
  {0x00, 0x56, 0x36, 0x00, 0x00},  /* 0x3B ; */
  {0x08, 0x14, 0x22, 0x41, 0x00},  /* 0x3C < */
  {0x14, 0x14, 0x14, 0x14, 0x14},  /* 0x3D = */
  {0x00, 0x41, 0x22, 0x14, 0x08},  /* 0x3E > */
  {0x02, 0x01, 0x51, 0x09, 0x06},  /* 0x3F ? */
  {0x32, 0x49, 0x79, 0x41, 0x3e},  /* 0x40 @ */
  {0x7e, 0x11, 0x11, 0x11, 0x7e},  /* 0x41 A */
  {0x7f, 0x49, 0x49, 0x49, 0x36},  /* 0x42 B */
  {0x3e, 0x41, 0x41, 0x41, 0x22},  /* 0x43 C */
  {0x7f, 0x41, 0x41, 0x22, 0x1c},  /* 0x44 D */
  {0x7f, 0x49, 0x49, 0x49, 0x41},  /* 0x45 E */
  {0x7f, 0x09, 0x09, 0x09, 0x01},  /* 0x46 F */
  {0x3e, 0x41, 0x49, 0x49, 0x7a},  /* 0x47 G */
  {0x7f, 0x08, 0x08, 0x08, 0x7f},  /* 0x48 H */
  {0x00, 0x41, 0x7f, 0x41, 0x00},  /* 0x49 I */
  {0x20, 0x40, 0x41, 0x3f, 0x01},  /* 0x4A J */
  {0x7f, 0x08, 0x14, 0x22, 0x41},  /* 0x4B K */
  {0x7f, 0x40, 0x40, 0x40, 0x40},  /* 0x4C L */
  {0x7f, 0x02, 0x0c, 0x02, 0x7f},  /* 0x4D M */
  {0x7f, 0x04, 0x08, 0x10, 0x7f},  /* 0x4E N */
  {0x3e, 0x41, 0x41, 0x41, 0x3e},  /* 0x4F O */
  {0x7f, 0x09, 0x09, 0x09, 0x06},  /* 0x50 P */
  {0x3e, 0x41, 0x51, 0x21, 0x5e},  /* 0x51 Q */
  {0x7f, 0x09, 0x19, 0x29, 0x46},  /* 0x52 R */
  {0x46, 0x49, 0x49, 0x49, 0x31},  /* 0x53 S */
  {0x01, 0x01, 0x7f, 0x01, 0x01},  /* 0x54 T */
  {0x3f, 0x40, 0x40, 0x40, 0x3f},  /* 0x55 U */
  {0x1f, 0x20, 0x40, 0x20, 0x1f},  /* 0x56 V */
  {0x3f, 0x40, 0x38, 0x40, 0x3f},  /* 0x57 W */
  {0x63, 0x14, 0x08, 0x14, 0x63},  /* 0x58 X */
  {0x07, 0x08, 0x70, 0x08, 0x07},  /* 0x59 Y */
  {0x61, 0x51, 0x49, 0x45, 0x43},  /* 0x5A Z */
  {0x00, 0x7f, 0x41, 0x41, 0x00},  /* 0x5B [ */
  {0x02, 0x04, 0x08, 0x10, 0x20},  /* 0x5C \ */
  {0x00, 0x41, 0x41, 0x7f, 0x00},  /* 0x5D ] */
  {0x04, 0x02, 0x01, 0x02, 0x04},  /* 0x5E ^ */
  {0x40, 0x40, 0x40, 0x40, 0x40},  /* 0x5F _ */
  {0x00, 0x01, 0x02, 0x04, 0x00},  /* 0x60 ` */
  {0x20, 0x54, 0x54, 0x54, 0x78},  /* 0x61 a */
  {0x7f, 0x48, 0x44, 0x44, 0x38},  /* 0x62 b */
  {0x38, 0x44, 0x44, 0x44, 0x20},  /* 0x63 c */
  {0x38, 0x44, 0x44, 0x48, 0x7f},  /* 0x64 d */
  {0x38, 0x54, 0x54, 0x54, 0x18},  /* 0x65 e */
  {0x08, 0x7e, 0x09, 0x01, 0x02},  /* 0x66 f */
  {0x0c, 0x52, 0x52, 0x52, 0x3e},  /* 0x67 g */
  {0x7f, 0x08, 0x04, 0x04, 0x78},  /* 0x68 h */
  {0x00, 0x44, 0x7d, 0x40, 0x00},  /* 0x69 i */
  {0x20, 0x40, 0x44, 0x3d, 0x00},  /* 0x6A j */
  {0x7f, 0x10, 0x28, 0x44, 0x00},  /* 0x6B k */
  {0x00, 0x41, 0x7f, 0x40, 0x00},  /* 0x6C l */
  {0x7c, 0x04, 0x18, 0x04, 0x78},  /* 0x6D m */
  {0x7c, 0x08, 0x04, 0x04, 0x78},  /* 0x6E n */
  {0x38, 0x44, 0x44, 0x44, 0x38},  /* 0x6F o */
  {0x7c, 0x14, 0x14, 0x14, 0x08},  /* 0x70 p */
  {0x08, 0x14, 0x14, 0x18, 0x7c},  /* 0x71 q */
  {0x7c, 0x08, 0x04, 0x04, 0x08},  /* 0x72 r */
  {0x48, 0x54, 0x54, 0x54, 0x20},  /* 0x73 s */
  {0x04, 0x3f, 0x44, 0x40, 0x20},  /* 0x74 t */
  {0x3c, 0x40, 0x40, 0x20, 0x7c},  /* 0x75 u */
  {0x1c, 0x20, 0x40, 0x20, 0x1c},  /* 0x76 v */
  {0x3c, 0x40, 0x30, 0x40, 0x3c},  /* 0x77 w */
  {0x44, 0x28, 0x10, 0x28, 0x44},  /* 0x78 x */
  {0x0c, 0x50, 0x50, 0x50, 0x3c},  /* 0x79 y */
  {0x44, 0x64, 0x54, 0x4c, 0x44},  /* 0x7A z */
  {0x00, 0x08, 0x36, 0x41, 0x00},  /* 0x7B { */
  {0x00, 0x00, 0x7f, 0x00, 0x00},  /* 0x7C | */
  {0x00, 0x41, 0x36, 0x08, 0x00},  /* 0x7D } */
  {0x10, 0x08, 0x08, 0x10, 0x08},  /* 0x7E ~ */
};

/****************************************************************************
 * Font Data: 8x16 Bitmap Font
 *
 * Scaled version of 5x8 font for larger text rendering.
 * Each character is 8 bytes wide, 16 bits tall.
 * Two bytes per column (top 8 bits, bottom 8 bits).
 *
 * Supports ASCII 0x20-0x7E (95 printable characters).
 ****************************************************************************/

static const uint8_t g_font8x16[][16] =
{
  /* 0x20 Space */
  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x21 ! */
  {0x00, 0x00, 0x00, 0xFC, 0xFC, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x0D, 0x0D, 0x00, 0x00, 0x00},
  /* 0x22 " */
  {0x00, 0x1E, 0x1E, 0x00, 0x00, 0x1E, 0x1E, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x23 # */
  {0x20, 0x20, 0xFC, 0x20, 0xFC, 0x20, 0x20, 0x00,
   0x02, 0x0F, 0x02, 0x0F, 0x02, 0x02, 0x00, 0x00},
  /* 0x24 $ */
  {0x30, 0x48, 0xFC, 0x88, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x08, 0x1F, 0x09, 0x06, 0x00, 0x00, 0x00},
  /* 0x25 % */
  {0x18, 0x24, 0x18, 0xC0, 0x30, 0x08, 0x00, 0x00,
   0x00, 0x08, 0x06, 0x01, 0x0C, 0x12, 0x0C, 0x00},
  /* 0x26 & */
  {0x00, 0xB8, 0x44, 0x44, 0x38, 0x00, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x05, 0x0E, 0x08, 0x07, 0x00},
  /* 0x27 ' */
  {0x00, 0x00, 0x1E, 0x1E, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x28 ( */
  {0x00, 0x00, 0xF0, 0x0C, 0x02, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x03, 0x0C, 0x10, 0x00, 0x00, 0x00},
  /* 0x29 ) */
  {0x00, 0x00, 0x02, 0x0C, 0xF0, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x0C, 0x03, 0x00, 0x00, 0x00},
  /* 0x2A * */
  {0x10, 0x54, 0x38, 0xFE, 0x38, 0x54, 0x10, 0x00,
   0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00},
  /* 0x2B + */
  {0x20, 0x20, 0x20, 0xFC, 0x20, 0x20, 0x20, 0x00,
   0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00},
  /* 0x2C , */
  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x20, 0x10, 0x00, 0x00, 0x00, 0x00},
  /* 0x2D - */
  {0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x2E . */
  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},
  /* 0x2F / */
  {0x00, 0x00, 0x00, 0xC0, 0x30, 0x0C, 0x02, 0x00,
   0x10, 0x0C, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x30 0 */
  {0xF8, 0x04, 0x04, 0x04, 0x04, 0xF8, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x31 1 */
  {0x00, 0x08, 0x08, 0xFC, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x08, 0x08, 0x0F, 0x08, 0x08, 0x00, 0x00},
  /* 0x32 2 */
  {0x08, 0x04, 0x04, 0x84, 0x44, 0x38, 0x00, 0x00,
   0x0C, 0x0A, 0x09, 0x08, 0x08, 0x08, 0x00, 0x00},
  /* 0x33 3 */
  {0x08, 0x04, 0x44, 0x44, 0x44, 0xB8, 0x00, 0x00,
   0x04, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x34 4 */
  {0xC0, 0xA0, 0x90, 0x88, 0xFC, 0x80, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00},
  /* 0x35 5 */
  {0x7C, 0x44, 0x44, 0x44, 0x44, 0x84, 0x00, 0x00,
   0x04, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x36 6 */
  {0xF0, 0x88, 0x44, 0x44, 0x44, 0x80, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x37 7 */
  {0x04, 0x04, 0x04, 0xC4, 0x34, 0x0C, 0x00, 0x00,
   0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x38 8 */
  {0xB8, 0x44, 0x44, 0x44, 0x44, 0xB8, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x39 9 */
  {0x38, 0x44, 0x44, 0x44, 0x44, 0xF8, 0x00, 0x00,
   0x00, 0x08, 0x08, 0x08, 0x04, 0x03, 0x00, 0x00},
  /* 0x3A : */
  {0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00},
  /* 0x3B ; */
  {0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x26, 0x16, 0x00, 0x00, 0x00, 0x00},
  /* 0x3C < */
  {0x20, 0x50, 0x88, 0x04, 0x02, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x01, 0x02, 0x00, 0x00, 0x00},
  /* 0x3D = */
  {0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x00, 0x00,
   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00},
  /* 0x3E > */
  {0x00, 0x02, 0x04, 0x88, 0x50, 0x20, 0x00, 0x00,
   0x00, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x3F ? */
  {0x18, 0x04, 0x04, 0xC4, 0x24, 0x18, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x00},
  /* 0x40 @ */
  {0xF0, 0x08, 0xC4, 0x24, 0xE4, 0x08, 0xF0, 0x00,
   0x03, 0x04, 0x09, 0x0A, 0x09, 0x0A, 0x01, 0x00},
  /* 0x41 A */
  {0x00, 0xC0, 0x30, 0x0C, 0x30, 0xC0, 0x00, 0x00,
   0x0E, 0x01, 0x00, 0x00, 0x00, 0x01, 0x0E, 0x00},
  /* 0x42 B */
  {0xFC, 0x44, 0x44, 0x44, 0x44, 0xB8, 0x00, 0x00,
   0x0F, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x43 C */
  {0xF0, 0x08, 0x04, 0x04, 0x04, 0x08, 0x00, 0x00,
   0x03, 0x04, 0x08, 0x08, 0x08, 0x04, 0x00, 0x00},
  /* 0x44 D */
  {0xFC, 0x04, 0x04, 0x04, 0x08, 0xF0, 0x00, 0x00,
   0x0F, 0x08, 0x08, 0x08, 0x04, 0x03, 0x00, 0x00},
  /* 0x45 E */
  {0xFC, 0x44, 0x44, 0x44, 0x44, 0x04, 0x00, 0x00,
   0x0F, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00},
  /* 0x46 F */
  {0xFC, 0x44, 0x44, 0x44, 0x44, 0x04, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x47 G */
  {0xF0, 0x08, 0x04, 0x84, 0x84, 0x88, 0x00, 0x00,
   0x03, 0x04, 0x08, 0x08, 0x08, 0x0F, 0x00, 0x00},
  /* 0x48 H */
  {0xFC, 0x40, 0x40, 0x40, 0x40, 0xFC, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00},
  /* 0x49 I */
  {0x00, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x00, 0x00,
   0x00, 0x08, 0x08, 0x0F, 0x08, 0x08, 0x00, 0x00},
  /* 0x4A J */
  {0x00, 0x00, 0x00, 0x04, 0x04, 0xFC, 0x00, 0x00,
   0x06, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x4B K */
  {0xFC, 0x40, 0xA0, 0x10, 0x08, 0x04, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x01, 0x02, 0x0C, 0x00, 0x00},
  /* 0x4C L */
  {0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x0F, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00},
  /* 0x4D M */
  {0xFC, 0x18, 0x60, 0x60, 0x18, 0xFC, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00},
  /* 0x4E N */
  {0xFC, 0x10, 0x20, 0x40, 0x80, 0xFC, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x01, 0x0F, 0x00, 0x00},
  /* 0x4F O */
  {0xF0, 0x08, 0x04, 0x04, 0x08, 0xF0, 0x00, 0x00,
   0x03, 0x04, 0x08, 0x08, 0x04, 0x03, 0x00, 0x00},
  /* 0x50 P */
  {0xFC, 0x44, 0x44, 0x44, 0x44, 0x38, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x51 Q */
  {0xF0, 0x08, 0x04, 0x04, 0x08, 0xF0, 0x00, 0x00,
   0x03, 0x04, 0x08, 0x18, 0x24, 0x23, 0x00, 0x00},
  /* 0x52 R */
  {0xFC, 0x44, 0x44, 0x44, 0xC4, 0x38, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x01, 0x02, 0x0C, 0x00, 0x00},
  /* 0x53 S */
  {0x18, 0x24, 0x44, 0x44, 0x84, 0x08, 0x00, 0x00,
   0x04, 0x08, 0x08, 0x08, 0x09, 0x06, 0x00, 0x00},
  /* 0x54 T */
  {0x04, 0x04, 0x04, 0xFC, 0x04, 0x04, 0x04, 0x00,
   0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00},
  /* 0x55 U */
  {0xFC, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00,
   0x03, 0x04, 0x08, 0x08, 0x04, 0x03, 0x00, 0x00},
  /* 0x56 V */
  {0x0C, 0x30, 0xC0, 0x00, 0xC0, 0x30, 0x0C, 0x00,
   0x00, 0x00, 0x01, 0x0E, 0x01, 0x00, 0x00, 0x00},
  /* 0x57 W */
  {0x1C, 0xE0, 0x00, 0xF0, 0x00, 0xE0, 0x1C, 0x00,
   0x00, 0x0F, 0x0E, 0x01, 0x0E, 0x0F, 0x00, 0x00},
  /* 0x58 X */
  {0x0C, 0x10, 0x60, 0x80, 0x60, 0x10, 0x0C, 0x00,
   0x0C, 0x02, 0x01, 0x00, 0x01, 0x02, 0x0C, 0x00},
  /* 0x59 Y */
  {0x0C, 0x10, 0x20, 0xC0, 0x20, 0x10, 0x0C, 0x00,
   0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00},
  /* 0x5A Z */
  {0x04, 0x04, 0x84, 0x44, 0x24, 0x1C, 0x04, 0x00,
   0x0C, 0x0A, 0x09, 0x08, 0x08, 0x08, 0x08, 0x00},
  /* 0x5B [ */
  {0x00, 0x00, 0xFE, 0x02, 0x02, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x1F, 0x10, 0x10, 0x00, 0x00, 0x00},
  /* 0x5C \ */
  {0x02, 0x0C, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x03, 0x0C, 0x10, 0x00},
  /* 0x5D ] */
  {0x00, 0x00, 0x02, 0x02, 0xFE, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x10, 0x1F, 0x00, 0x00, 0x00},
  /* 0x5E ^ */
  {0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x5F _ */
  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00},
  /* 0x60 ` */
  {0x00, 0x02, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x61 a */
  {0x00, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x00, 0x07, 0x08, 0x08, 0x04, 0x0F, 0x08, 0x00},
  /* 0x62 b */
  {0xFC, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x0F, 0x04, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x63 c */
  {0xC0, 0x20, 0x20, 0x20, 0x20, 0x40, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x08, 0x04, 0x00, 0x00},
  /* 0x64 d */
  {0xC0, 0x20, 0x20, 0x20, 0x20, 0xFC, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x04, 0x0F, 0x08, 0x00},
  /* 0x65 e */
  {0xC0, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x07, 0x09, 0x09, 0x09, 0x09, 0x01, 0x00, 0x00},
  /* 0x66 f */
  {0x20, 0xF8, 0x24, 0x24, 0x04, 0x00, 0x00, 0x00,
   0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x67 g */
  {0xC0, 0x20, 0x20, 0x20, 0x20, 0xE0, 0x00, 0x00,
   0x13, 0x24, 0x24, 0x24, 0x22, 0x1F, 0x00, 0x00},
  /* 0x68 h */
  {0xFC, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x08, 0x00},
  /* 0x69 i */
  {0x00, 0x00, 0x20, 0xE4, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x08, 0x0F, 0x08, 0x00, 0x00, 0x00},
  /* 0x6A j */
  {0x00, 0x00, 0x00, 0x20, 0xE4, 0x00, 0x00, 0x00,
   0x00, 0x20, 0x20, 0x20, 0x1F, 0x00, 0x00, 0x00},
  /* 0x6B k */
  {0x00, 0xFC, 0x80, 0x40, 0x20, 0x00, 0x00, 0x00,
   0x00, 0x0F, 0x01, 0x02, 0x04, 0x08, 0x00, 0x00},
  /* 0x6C l */
  {0x00, 0x00, 0x04, 0xFC, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x08, 0x0F, 0x08, 0x00, 0x00, 0x00},
  /* 0x6D m */
  {0xE0, 0x20, 0xE0, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x0F, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x08, 0x00},
  /* 0x6E n */
  {0xE0, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x08, 0x00},
  /* 0x6F o */
  {0xC0, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x70 p */
  {0xE0, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00,
   0x3F, 0x04, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00},
  /* 0x71 q */
  {0xC0, 0x20, 0x20, 0x20, 0x20, 0xE0, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x04, 0x3F, 0x00, 0x00},
  /* 0x72 r */
  {0xE0, 0x20, 0x20, 0x20, 0x20, 0x40, 0x00, 0x00,
   0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
  /* 0x73 s */
  {0x40, 0xA0, 0x20, 0x20, 0x20, 0x40, 0x00, 0x00,
   0x04, 0x08, 0x08, 0x08, 0x09, 0x06, 0x00, 0x00},
  /* 0x74 t */
  {0x20, 0xF8, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x07, 0x08, 0x08, 0x04, 0x00, 0x00, 0x00},
  /* 0x75 u */
  {0xE0, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x00, 0x00,
   0x07, 0x08, 0x08, 0x08, 0x04, 0x0F, 0x08, 0x00},
  /* 0x76 v */
  {0x60, 0x80, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00,
   0x00, 0x01, 0x0E, 0x0E, 0x01, 0x00, 0x00, 0x00},
  /* 0x77 w */
  {0xE0, 0x00, 0xE0, 0xE0, 0x00, 0xE0, 0x00, 0x00,
   0x03, 0x0C, 0x03, 0x03, 0x0C, 0x03, 0x00, 0x00},
  /* 0x78 x */
  {0x20, 0x40, 0x80, 0x00, 0x80, 0x40, 0x20, 0x00,
   0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08, 0x00},
  /* 0x79 y */
  {0x60, 0x80, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00,
   0x10, 0x21, 0x22, 0x1C, 0x03, 0x00, 0x00, 0x00},
  /* 0x7A z */
  {0x20, 0x20, 0x20, 0xA0, 0x60, 0x20, 0x00, 0x00,
   0x08, 0x0C, 0x0A, 0x09, 0x08, 0x08, 0x00, 0x00},
  /* 0x7B { */
  {0x00, 0x00, 0x40, 0xBC, 0x02, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x0F, 0x10, 0x00, 0x00, 0x00},
  /* 0x7C | */
  {0x00, 0x00, 0x00, 0xFE, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00},
  /* 0x7D } */
  {0x00, 0x00, 0x02, 0xBC, 0x40, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00},
  /* 0x7E ~ */
  {0x20, 0x10, 0x10, 0x20, 0x20, 0x10, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
};

/****************************************************************************
 * Private Function Prototypes
 ****************************************************************************/

static esp_err_t ssd1306_write_command(uint8_t cmd);
static esp_err_t ssd1306_write_data(const uint8_t *data, size_t len);
static void ssd1306_draw_char_5x8(uint8_t x, uint8_t y, char ch);
static void ssd1306_draw_char_8x16(uint8_t x, uint8_t y, char ch);

/****************************************************************************
 * Private Functions
 ****************************************************************************/

/**
 * @brief Write single command byte to SSD1306 via I2C
 *
 * @param[in] cmd Command byte to send
 * @return ESP_OK on success, ESP_FAIL on I2C error
 */
static esp_err_t ssd1306_write_command(uint8_t cmd)
{
    uint8_t buffer[2];
    esp_err_t ret;

    if (g_ssd1306_handle == NULL)
    {
        ESP_LOGE(TAG, "Device not initialized");
        return ESP_ERR_INVALID_STATE;
    }

    buffer[0] = SSD1306_CONTROL_CMD_SINGLE;
    buffer[1] = cmd;

    ret = i2c_master_transmit(g_ssd1306_handle, buffer, 2,
                              SSD1306_TIMEOUT_MS);
    if (ret != ESP_OK)
    {
        ESP_LOGE(TAG, "I2C transmit cmd 0x%02X failed: %s",
                 cmd, esp_err_to_name(ret));
    }

    return ret;
}

/**
 * @brief Write data stream to SSD1306 GDDRAM via I2C
 *
 * @param[in] data Pointer to data buffer
 * @param[in] len Number of bytes to write
 * @return ESP_OK on success, ESP_FAIL on I2C error
 */
static esp_err_t ssd1306_write_data(const uint8_t *data, size_t len)
{
    uint8_t buffer[SSD1306_BUFFER_SIZE + 1];
    esp_err_t ret;

    if (g_ssd1306_handle == NULL)
    {
        ESP_LOGE(TAG, "Device not initialized");
        return ESP_ERR_INVALID_STATE;
    }

    if (len > SSD1306_BUFFER_SIZE)
    {
        ESP_LOGE(TAG, "Data length %zu exceeds buffer size %d",
                 len, SSD1306_BUFFER_SIZE);
        return ESP_ERR_INVALID_SIZE;
    }

    buffer[0] = SSD1306_CONTROL_DATA_STREAM;
    memcpy(&buffer[1], data, len);

    ret = i2c_master_transmit(g_ssd1306_handle, buffer, len + 1,
                              SSD1306_TIMEOUT_MS);
    if (ret != ESP_OK)
    {
        ESP_LOGE(TAG, "I2C transmit data (%zu bytes) failed: %s",
                 len, esp_err_to_name(ret));
    }

    return ret;
}

/**
 * @brief Draw single character using 5x8 font
 *
 * @param[in] x X coordinate (pixels)
 * @param[in] y Y coordinate (pixels)
 * @param[in] ch ASCII character (0x20-0x7E)
 */
static void ssd1306_draw_char_5x8(uint8_t x, uint8_t y, char ch)
{
    uint8_t font_idx;
    uint8_t col;
    uint8_t row;
    uint8_t line;

    /* Validate printable ASCII range */

    if (ch < FONT_FIRST_CHAR || ch > FONT_LAST_CHAR)
    {
        return;
    }

    font_idx = ch - FONT_FIRST_CHAR;

    /* Draw each column of the character */

    for (col = 0; col < FONT_5X8_WIDTH; col++)
    {
        line = g_font5x8[font_idx][col];

        for (row = 0; row < FONT_5X8_HEIGHT; row++)
        {
            if (line & (1 << row))
            {
                ssd1306_set_pixel(x + col, y + row, true);
            }
        }
    }
}

/**
 * @brief Draw single character using 8x16 font
 *
 * @param[in] x X coordinate (pixels)
 * @param[in] y Y coordinate (pixels)
 * @param[in] ch ASCII character (0x20-0x7E)
 */
static void ssd1306_draw_char_8x16(uint8_t x, uint8_t y, char ch)
{
    uint8_t font_idx;
    uint8_t col;
    uint8_t row;
    uint8_t line_top;
    uint8_t line_bottom;

    /* Validate printable ASCII range */

    if (ch < FONT_FIRST_CHAR || ch > FONT_LAST_CHAR)
    {
        return;
    }

    font_idx = ch - FONT_FIRST_CHAR;

    /* Draw each column of the character (8 columns) */

    for (col = 0; col < FONT_8X16_WIDTH; col++)
    {
        line_top = g_font8x16[font_idx][col];
        line_bottom = g_font8x16[font_idx][col + 8];

        /* Top 8 rows */

        for (row = 0; row < 8; row++)
        {
            if (line_top & (1 << row))
            {
                ssd1306_set_pixel(x + col, y + row, true);
            }
        }

        /* Bottom 8 rows */

        for (row = 0; row < 8; row++)
        {
            if (line_bottom & (1 << row))
            {
                ssd1306_set_pixel(x + col, y + row + 8, true);
            }
        }
    }
}

/****************************************************************************
 * Public Functions
 ****************************************************************************/

/**
 * @brief Initialize SSD1306 display driver
 */
esp_err_t ssd1306_init(void)
{
    esp_err_t ret;
    i2c_master_bus_handle_t bus_handle;
    i2c_device_config_t dev_cfg;

    ESP_LOGI(TAG, "Initializing SSD1306 OLED display (%dx%d)",
             SSD1306_WIDTH, SSD1306_HEIGHT);

    /* Get I2C bus handle from maia_board */

    bus_handle = maia_i2c_get_bus_handle();
    if (bus_handle == NULL)
    {
        ESP_LOGE(TAG, "I2C bus not initialized");
        return ESP_ERR_INVALID_STATE;
    }

    /* Configure I2C device */

    memset(&dev_cfg, 0, sizeof(dev_cfg));
    dev_cfg.dev_addr_length = I2C_ADDR_BIT_LEN_7;
    dev_cfg.device_address = SSD1306_I2C_ADDR;
    dev_cfg.scl_speed_hz = CONFIG_MAIA_I2C_FREQ_HZ;

    ret = i2c_master_bus_add_device(bus_handle, &dev_cfg,
                                    &g_ssd1306_handle);
    if (ret != ESP_OK)
    {
        ESP_LOGE(TAG, "Failed to add I2C device: %s",
                 esp_err_to_name(ret));
        return ret;
    }

    ESP_LOGI(TAG, "I2C device configured @ 0x%02X", SSD1306_I2C_ADDR);

    /* Hardware initialization sequence (SSD1306 datasheet) */

    ssd1306_write_command(SSD1306_CMD_DISPLAY_OFF);

    ssd1306_write_command(SSD1306_CMD_SET_DISPLAY_CLK_DIV);
    ssd1306_write_command(0x80);  /* Default oscillator frequency */

    ssd1306_write_command(SSD1306_CMD_SET_MULTIPLEX);
    ssd1306_write_command(SSD1306_HEIGHT - 1);  /* 31 for 32 lines */

    ssd1306_write_command(SSD1306_CMD_SET_DISPLAY_OFFSET);
    ssd1306_write_command(0x00);  /* No vertical offset */

    ssd1306_write_command(SSD1306_CMD_SET_START_LINE | 0x00);

    ssd1306_write_command(SSD1306_CMD_CHARGE_PUMP);
    ssd1306_write_command(0x14);  /* Enable charge pump */

    ssd1306_write_command(SSD1306_CMD_MEMORY_MODE);
    ssd1306_write_command(0x00);  /* Horizontal addressing mode */

    /* Apply rotation configuration */

#ifdef CONFIG_MAIA_SSD1306_ROTATION_180
    ssd1306_write_command(SSD1306_CMD_SEG_REMAP | 0x00);  /* No remap */
    ssd1306_write_command(SSD1306_CMD_COM_SCAN_INC);      /* Normal scan */
#else
    ssd1306_write_command(SSD1306_CMD_SEG_REMAP | 0x01);  /* Remap */
    ssd1306_write_command(SSD1306_CMD_COM_SCAN_DEC);      /* Reverse */
#endif

    ssd1306_write_command(SSD1306_CMD_SET_COMPINS);
    ssd1306_write_command(0x02);  /* Sequential COM, no remap */

    /* Set contrast from Kconfig */

    ssd1306_write_command(SSD1306_CMD_SET_CONTRAST);
    ssd1306_write_command(CONFIG_MAIA_SSD1306_CONTRAST);

    ssd1306_write_command(SSD1306_CMD_SET_PRECHARGE);
    ssd1306_write_command(0xF1);  /* Phase 1: 15 clocks, Phase 2: 1 */

    ssd1306_write_command(SSD1306_CMD_SET_VCOMH_DESELECT);
    ssd1306_write_command(0x40);  /* 0.77 * VCC */

    ssd1306_write_command(SSD1306_CMD_DISPLAY_ALL_ON_RESUME);
    ssd1306_write_command(SSD1306_CMD_NORMAL_DISPLAY);

    ssd1306_write_command(SSD1306_CMD_DISPLAY_ON);

    ESP_LOGI(TAG, "Hardware initialization complete");

    /* Clear framebuffer and display */

    ssd1306_clear();
    ssd1306_display();

    ESP_LOGI(TAG, "SSD1306 initialization successful");

    return ESP_OK;
}

/**
 * @brief Clear framebuffer (set all pixels OFF)
 */
esp_err_t ssd1306_clear(void)
{
    memset(g_framebuffer, 0, SSD1306_BUFFER_SIZE);
    return ESP_OK;
}

/**
 * @brief Flush framebuffer to display GDDRAM
 */
esp_err_t ssd1306_display(void)
{
    esp_err_t ret;

    /* Set column address range (0-127) */

    ret = ssd1306_write_command(SSD1306_CMD_COLUMN_ADDR);
    if (ret != ESP_OK) return ret;

    ret = ssd1306_write_command(0);  /* Column start */
    if (ret != ESP_OK) return ret;

    ret = ssd1306_write_command(SSD1306_WIDTH - 1);  /* Column end */
    if (ret != ESP_OK) return ret;

    /* Set page address range (0-3 for 32-line display) */

    ret = ssd1306_write_command(SSD1306_CMD_PAGE_ADDR);
    if (ret != ESP_OK) return ret;

    ret = ssd1306_write_command(0);  /* Page start */
    if (ret != ESP_OK) return ret;

    ret = ssd1306_write_command((SSD1306_HEIGHT / 8) - 1);  /* Page end */
    if (ret != ESP_OK) return ret;

    /* Transmit entire framebuffer */

    ret = ssd1306_write_data(g_framebuffer, SSD1306_BUFFER_SIZE);
    if (ret != ESP_OK)
    {
        ESP_LOGE(TAG, "Failed to write framebuffer to display");
        return ret;
    }

    return ESP_OK;
}

/**
 * @brief Set individual pixel state in framebuffer
 */
esp_err_t ssd1306_set_pixel(uint8_t x, uint8_t y, bool on)
{
    uint16_t byte_idx;
    uint8_t bit_idx;

    /* Validate coordinates */

    if (x >= SSD1306_WIDTH || y >= SSD1306_HEIGHT)
    {
        return ESP_ERR_INVALID_ARG;
    }

    /* Calculate framebuffer position (page-based addressing) */

    byte_idx = x + (y / 8) * SSD1306_WIDTH;
    bit_idx = y % 8;

    /* Set or clear bit */

    if (on)
    {
        g_framebuffer[byte_idx] |= (1 << bit_idx);
    }
    else
    {
        g_framebuffer[byte_idx] &= ~(1 << bit_idx);
    }

    return ESP_OK;
}

/**
 * @brief Draw single ASCII character at specified position
 */
esp_err_t ssd1306_draw_char(uint8_t x, uint8_t y, char ch,
                            ssd1306_font_t font)
{
    /* Validate coordinates */

    if (x >= SSD1306_WIDTH || y >= SSD1306_HEIGHT)
    {
        return ESP_ERR_INVALID_ARG;
    }

    /* Validate character */

    if (ch < FONT_FIRST_CHAR || ch > FONT_LAST_CHAR)
    {
        return ESP_ERR_INVALID_ARG;
    }

    /* Draw character using selected font */

    if (font == SSD1306_FONT_SMALL)
    {
        ssd1306_draw_char_5x8(x, y, ch);
    }
    else
    {
        ssd1306_draw_char_8x16(x, y, ch);
    }

    return ESP_OK;
}

/**
 * @brief Draw null-terminated string at specified position
 */
esp_err_t ssd1306_draw_string(uint8_t x, uint8_t y, const char *str,
                              ssd1306_font_t font)
{
    uint8_t spacing;
    uint8_t cursor_x = x;

    /* Validate string pointer */

    if (str == NULL)
    {
        return ESP_ERR_INVALID_ARG;
    }

    /* Validate starting coordinates */

    if (x >= SSD1306_WIDTH || y >= SSD1306_HEIGHT)
    {
        return ESP_ERR_INVALID_ARG;
    }

    /* Determine character spacing */

    if (font == SSD1306_FONT_SMALL)
    {
        spacing = FONT_5X8_WIDTH + 1;  /* 5px char + 1px space */
    }
    else
    {
        spacing = FONT_8X16_WIDTH + 1;  /* 8px char + 1px space */
    }

    /* Draw each character */

    while (*str != '\0')
    {
        /* Stop if character would go off-screen */

        if (cursor_x + spacing > SSD1306_WIDTH)
        {
            break;
        }

        ssd1306_draw_char(cursor_x, y, *str, font);

        cursor_x += spacing;
        str++;
    }

    return ESP_OK;
}

/**
 * @brief Turn display ON (wake from sleep)
 */
esp_err_t ssd1306_screen_on(void)
{
    esp_err_t ret;

    ret = ssd1306_write_command(SSD1306_CMD_DISPLAY_ON);
    if (ret == ESP_OK)
    {
        ESP_LOGI(TAG, "Display turned ON");
    }

    return ret;
}

/**
 * @brief Turn display OFF (enter sleep mode)
 */
esp_err_t ssd1306_screen_off(void)
{
    esp_err_t ret;

    ret = ssd1306_write_command(SSD1306_CMD_DISPLAY_OFF);
    if (ret == ESP_OK)
    {
        ESP_LOGI(TAG, "Display turned OFF");
    }

    return ret;
}

/**
 * @brief Set display contrast/brightness at runtime
 */
esp_err_t ssd1306_set_contrast(uint8_t contrast)
{
    esp_err_t ret;

    ret = ssd1306_write_command(SSD1306_CMD_SET_CONTRAST);
    if (ret != ESP_OK) return ret;

    ret = ssd1306_write_command(contrast);
    if (ret == ESP_OK)
    {
        ESP_LOGI(TAG, "Contrast set to %d", contrast);
    }

    return ret;
}
